<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN" "http://www.w3.org/TR/html4/loose.dtd">
<html>

<head>
  <title>Технология IFA - дополнительные приложения для XSL</title>
  <meta name="GENERATOR" content="Quanta Plus">
  <meta name="AUTHOR" content="Devaev Maxim">
  <meta http-equiv="Content-Type" content="text/html; charset=utf-8">
</head>
<body>
<table border="0" width="100%"><tr><td bgcolor="#DFEDFF"><h2 align="center"><img src="lightlang.png" align="top" border="0"></h2></td></tr></table>
<hr>
<h2>Технология IFA - дополнительные приложения для XSL</h2>
<hr>
&nbsp;&nbsp;&nbsp;Технология <strong>IFA</strong> (Integratable Friend Applications) позволяет программам расширять функциональность друг друга, добавляя возможность запуска одного приложения из другого и обеспечивая возможность выполнения произвольного <strong>API</strong> родительского приложения до и после запуска дочернего приложения.<br>
&nbsp;&nbsp;&nbsp;Если одно приложение (дочернее) желает расширить функциональность другого приложения (родительское), дав возможность программе-родителю запускать себя с определенными параметрами, оно должно предоставить ему описание способа собственного запуска и (возможно) последовательность необходимых <strong>API</strong>-функций, производящих некоторые действия над родительским приложением до и после запуска дочернего приложения. Это достигается применением простых <strong>XML</strong>-файлов, содержащих всю необходимую информацию. Родительское приложение читает этот файл и регистрирует все данные о приложении. Затем (в зависимости от реализации) создает пункт меню, активировав который, пользователь может запустить дочернее приложение.<br>
&nbsp;&nbsp;&nbsp;Отличие этой технологии от обычных файлов расширения меню состоит в возможности доступа к <strong>API</strong> родительского приложения для <strong>XML</strong>-файла. Это может оказаться полезным, если, например, дочернее приложение устанавливает некоторые файлы, а родительское приложение оперирует этими файлами, тогда после окончания работы дочернего приложения можно сделать автоматическое обновление списка доступных файлов родительского приложения. Возможность доступа к <strong>API</strong> различается в зависимости от языка, на котором написана (или от языка запросов к <strong>API</strong>). В интерпретируемых или компилируемых в байт-код языках (<strong>Python</strong>, например), выполнение произвольных функций может быть обеспечено использованием встроенных возможностей (<strong>exec</strong> в <strong>Python</strong>), другие же языки могут потребовать встраивания интерпретаторов, или других средств выполнения скриптов. Например, реализация для <strong>C++</strong> и <strong>Qt4</strong> может выглядеть, как интерпретация языка <strong>QSA</strong>.<br>
&nbsp;&nbsp;&nbsp;Файлы <strong>IFA</strong> так же имеют возможность локализации для изменения языка описания приложения. По умолчанию используется кодировка <strong>UTF-8</strong>, но реализация может быть различной.<br>
&nbsp;&nbsp;&nbsp;Ниже дан пример файла <strong>IFA</strong> для <strong>XSL</strong>, описывающий запуск терминала:<br>
<table border="0" width="100%"><tr><td bgcolor="#FFFBE0">&nbsp;&nbsp;&nbsp;<font color="blue">&lt;?xml <font color="green">version=</font><font color="purple">"1.0"</font> <font color="green">encoding=</font><font color="purple">"UTF-8"</font>?&gt;</font><br>
&nbsp;&nbsp;&nbsp;<font color="blue">&lt;app&gt;</font><br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<font color="blue">&lt;title&gt;</font>LLRepo Console<font color="blue">&lt;/title&gt;</font><br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<font color="blue">&lt;title <font color="green">lang=</font><font color="purple">"ru"</font>&gt;</font>Консоль LLRepo<font color="blue">&lt;/title&gt;</font><br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<font color="blue">&lt;description&gt;</font>LLRepo - root terminal mode<font color="blue">&lt;/description&gt;</font><br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<font color="blue">&lt;description <font color="green">lang=</font><font color="purple">"ru"</font>&gt;</font>LLRepo - терминал root<font color="blue">&lt;/description&gt;</font><br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<font color="blue">&lt;path&gt;</font>/usr/bin/xterm<font color="blue">&lt;/path&gt;</font><br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<font color="blue">&lt;options&gt;</font><br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;-e "echo To get started with LLRepo run su and enter the root password.<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;To learn more details about the available options, run man llrepo <font color="blue">&amp;amp;&amp;amp;</font> /bin/sh"<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<font color="blue">&lt;/options&gt;</font><br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<font color="blue">&lt;postcode <font color="green">lang=</font><font color="purple">"python"</font>&gt;</font><br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;main.main_window.dicts_manager.update()<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<font color="blue">&lt;/postcode&gt;</font><br>
&nbsp;&nbsp;&nbsp;<font color="blue">&lt;/app&gt;</font></td></tr></table><br>
&nbsp;&nbsp;&nbsp;В данном описании содержатся теги, задающие имя метки (текст пункта меню, которым будет вызываться дочерняя программа, например) по умолчанию и для Русской локали, описание того же формата (обычно отображается всплывающей подсказкой или, как в <strong>XSL</strong>, информацией в строке состояния в главном окне), путь к исполняемому файлу дочернего приложения, его опции и действия которые должны выполняться по завершению работы дочернего приложения.<br>
&nbsp;&nbsp;&nbsp;На последнем действии следует остановиться более подробно. Информация, заключенная между тегами  <em>&lt;postcode&gt;...&lt;/postcode&gt;</em> устанавливает последовательность функций родительского приложения (<strong>API</strong>), которые должны быть вызваны после закрытия дочернего приложения. Функции, в зависимости от реализации, могут быть представлены для выполнения в виде доступных интерпретатору команд, фиксированных строковых констант и т.п. В <strong>XSL</strong> это реализовано с помощью специального модуля, содержащего объект <em>main</em>, представляющий из себя главный объект программы, работая с которым можно обратиться к любому другому объекту или функции <strong>XSL</strong>. В данном случае мы обращаемся к функции <em>update()</em>, которая принадлежит объекту <em>dicts_manager</em>, находящемуся в главном окне <em>main_window</em>, к которому можно обратиться через объект <em>main</em>. Обязательный параметр <em>lang="python"</em> обозначает язык, с помощью которого возможно обратиться к объектам приложения, в случае с <strong>XSL</strong> это еще и язык, на котором было написано родительское приложение (следует отметить, что язык запросов и язык приложения могут различаться, в этом случае параметром указывается язык запросов). Аналогичный синтаксис и принцип работы имеет тег <em>&lt;precode&gt;...&lt;/precode&gt;</em>, обозначающий код, выполняемый до запуска дочернего приложения. Реализация должна гарантировать выполнение функций описанных в этих тегах, независимо от результата работы дочернего приложения и других факторов, если это явно не указано в выполняемых функциях. Так же гарантировано, что будут выполнены все функции линейно, не зависимо от выполнения предыдущей функции в пределах тега, то есть если перечислено несколько функций, то будут выполнены все, содержащие ошибку вызовы будут пропущены.<br>
<br>
<table border=1>
  <caption><h4><strong>XML</strong>-теги файлов описания <strong>IFA</strong></h4></caption>
  <tbody>
    <tr>
      <td><em>title</em></td>
      <td>Обозначает название приложения. Это текст, который, например, будет отображаться как пункт меню. Возможен необязательный параметр <em>lang</em>, для установки языка названия. Приоритет имеет тег с данным параметром, переопределяющий значение из тега по умолчанию (без параметра)</td>
    </tr>
    <tr>
      <td><em>description</em></td>
      <td>Служит для описания приложения. Работает точно так же, как и тег <em>title</em>, но устанавливает свою информацию, например, в строку статуса главного окна родительской программы при наведении курсора на пункт меню дочернего приложения.</td>
    </tr>
    <tr>
      <td><em>icon</em></td>
      <td>Определяет полный путь к иконке дочерней программы. Отображается, например, рядом с соответствующим пунктом меню.</td>
    </tr>
    <tr>
      <td><em>path</em></td>
      <td>Определяет полный путь к исполняемому файлу дочернего приложения. Используется при запуске.</td>
    </tr>
    <tr>
      <td><em>options</em></td>
      <td>Строка опций, которые будут переданы при запуске исполняемому файлу дочернего приложения. В принципе, реализация может содержать макросы, которые родительское приложение заменит на некоторые свои переменные при запуске. В текущей реализации они отсутствуют.</td>
    </tr>
    <tr>
      <td><em>precode</em></td>
      <td>Обозначает код родительского приложения, который должен быть выполнен до запуска дочерней программы. Хорошим тоном является размещение одной функции на строку. Тег должен иметь обязательный параметр <em>lang</em>, обозначающий язык для запросов функций.</td>
    </tr>
    <tr>
      <td><em>postcode</em></td>
      <td>Функционирует так же как и предыдущий тег, но код выполняется после завершения дочернего приложения.</td>
    </tr>
  </tbody>
</table>
<br>
&nbsp;&nbsp;&nbsp;Таким образом обеспечен более гибкий метод интеграции приложений по сравнению с аналогичными методами.<br>
&nbsp;&nbsp;&nbsp;<strong>IFA</strong> в <strong>XSL</strong> используется для добавления возможности запуска других языковых приложений в меню <em>Инструменты --&gt; Приложения</em>. Для создания файла-расширения необходимо сделать точное описание в <strong>XML</strong>-файле, используя приведенную выше информацию. Если вы планируете использовать теги <em>&lt;precode&gt;</em> или <em>&lt;postcode&gt;</em>, то передавайте в качестве параметра обоим тегам <em>lang="python"</em> (для использования кода вам придется изучить дерево постоянных объектов в исходном коде <strong>XSL</strong>). После этого разместите файл (должен иметь расширение <em>.xml</em> или <em>.ifa</em>) в каталоге <em>/usr/lib/xsl/ifa</em> (префикс <em>/usr</em> зависит соответствующего заданного при установке параметра). Если файл составлен корректно, то после перезапуска <strong>XSL</strong> вы получите пункт для нового приложения.
<br>
&nbsp;&nbsp;&nbsp;Автор оригинальной идеи и реализации для <strong>XSL</strong> - <em>Деваев Максим</em>. По всем вопросам применения данной технологии обращайтесь по электронной почте (<a href="mailto:mdevaev@gmail.com?subject=LightLang, IFA" title="mdevaev@gmail.com">mdevaev@gmail.com</a>).
<hr>
</body>
</html>
